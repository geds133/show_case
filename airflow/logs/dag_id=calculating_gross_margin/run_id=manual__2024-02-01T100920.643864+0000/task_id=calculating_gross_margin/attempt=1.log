[2024-02-01T10:35:34.770+0000] {taskinstance.py:1159} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: calculating_gross_margin.calculating_gross_margin manual__2024-02-01T10:09:20.643864+00:00 [queued]>
[2024-02-01T10:35:34.782+0000] {taskinstance.py:1159} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: calculating_gross_margin.calculating_gross_margin manual__2024-02-01T10:09:20.643864+00:00 [queued]>
[2024-02-01T10:35:34.783+0000] {taskinstance.py:1361} INFO - Starting attempt 1 of 2
[2024-02-01T10:35:34.798+0000] {taskinstance.py:1382} INFO - Executing <Task(PythonOperator): calculating_gross_margin> on 2024-02-01 10:09:20.643864+00:00
[2024-02-01T10:35:34.815+0000] {standard_task_runner.py:57} INFO - Started process 62 to run task
[2024-02-01T10:35:34.820+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'calculating_gross_margin', 'calculating_gross_margin', 'manual__2024-02-01T10:09:20.643864+00:00', '--job-id', '122', '--raw', '--subdir', 'DAGS_FOLDER/fundamental_data_pipeline.py', '--cfg-path', '/tmp/tmpua54iu1p']
[2024-02-01T10:35:34.825+0000] {standard_task_runner.py:85} INFO - Job 122: Subtask calculating_gross_margin
[2024-02-01T10:35:34.885+0000] {task_command.py:416} INFO - Running <TaskInstance: calculating_gross_margin.calculating_gross_margin manual__2024-02-01T10:09:20.643864+00:00 [running]> on host cd150dcb29cf
[2024-02-01T10:35:34.958+0000] {taskinstance.py:1662} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='gerardchurch133@outlook.com' AIRFLOW_CTX_DAG_OWNER='Airflow' AIRFLOW_CTX_DAG_ID='calculating_gross_margin' AIRFLOW_CTX_TASK_ID='calculating_gross_margin' AIRFLOW_CTX_EXECUTION_DATE='2024-02-01T10:09:20.643864+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='manual__2024-02-01T10:09:20.643864+00:00'
[2024-02-01T10:35:40.699+0000] {_universal.py:514} INFO - Request URL: 'https://datalakeuksouth2311.table.core.windows.net/fundamentalsraw()?$filter=REDACTED'
Request method: 'GET'
Request headers:
    'x-ms-version': 'REDACTED'
    'DataServiceVersion': 'REDACTED'
    'Accept': 'application/json;odata=minimalmetadata'
    'x-ms-client-request-id': 'a53b5d82-c0ed-11ee-968f-0242ac140005'
    'x-ms-date': 'REDACTED'
    'Date': 'Thu, 01 Feb 2024 10:35:40 GMT'
    'User-Agent': 'azsdk-python-data-tables/12.5.0 Python/3.8.18 (Linux-5.10.16.3-microsoft-standard-WSL2-x86_64-with-glibc2.2.5)'
    'Authorization': 'REDACTED'
No body was attached to the request
[2024-02-01T10:35:40.839+0000] {_universal.py:550} INFO - Response status: 200
Response headers:
    'Cache-Control': 'no-cache'
    'Transfer-Encoding': 'chunked'
    'Content-Type': 'application/json;odata=minimalmetadata;streaming=true;charset=utf-8'
    'Server': 'Windows-Azure-Table/1.0 Microsoft-HTTPAPI/2.0'
    'x-ms-request-id': '9422889c-2002-0042-70fa-5439ae000000'
    'x-ms-client-request-id': 'a53b5d82-c0ed-11ee-968f-0242ac140005'
    'x-ms-version': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'Date': 'Thu, 01 Feb 2024 10:35:42 GMT'
[2024-02-01T10:35:43.549+0000] {_universal.py:514} INFO - Request URL: 'https://datalakeuksouth2311.table.core.windows.net/fundamentals()?$filter=REDACTED'
Request method: 'GET'
Request headers:
    'x-ms-version': 'REDACTED'
    'DataServiceVersion': 'REDACTED'
    'Accept': 'application/json;odata=minimalmetadata'
    'x-ms-client-request-id': 'a6ee74fc-c0ed-11ee-968f-0242ac140005'
    'x-ms-date': 'REDACTED'
    'Date': 'Thu, 01 Feb 2024 10:35:43 GMT'
    'User-Agent': 'azsdk-python-data-tables/12.5.0 Python/3.8.18 (Linux-5.10.16.3-microsoft-standard-WSL2-x86_64-with-glibc2.2.5)'
    'Authorization': 'REDACTED'
No body was attached to the request
[2024-02-01T10:35:43.572+0000] {_universal.py:550} INFO - Response status: 200
Response headers:
    'Cache-Control': 'no-cache'
    'Transfer-Encoding': 'chunked'
    'Content-Type': 'application/json;odata=minimalmetadata;streaming=true;charset=utf-8'
    'Server': 'Windows-Azure-Table/1.0 Microsoft-HTTPAPI/2.0'
    'x-ms-request-id': '94228a3a-2002-0042-7efa-5439ae000000'
    'x-ms-client-request-id': 'a6ee74fc-c0ed-11ee-968f-0242ac140005'
    'x-ms-version': 'REDACTED'
    'X-Content-Type-Options': 'REDACTED'
    'Date': 'Thu, 01 Feb 2024 10:35:45 GMT'
[2024-02-01T10:35:43.857+0000] {taskinstance.py:1937} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 192, in execute
    return_value = self.execute_callable()
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 209, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/opt/airflow/dags/fundamental_data_pipeline.py", line 92, in get_gross_margin
    entities = fundamental_ddl.filter(fundamental_ddl.RowKey.isin(new_core_entities)).toJSON().collect()
  File "/home/airflow/.local/lib/python3.8/site-packages/pyspark/sql/column.py", line 972, in isin
    [c._jc if isinstance(c, Column) else _create_column_from_literal(c) for c in cols],
  File "/home/airflow/.local/lib/python3.8/site-packages/pyspark/sql/column.py", line 972, in <listcomp>
    [c._jc if isinstance(c, Column) else _create_column_from_literal(c) for c in cols],
  File "/home/airflow/.local/lib/python3.8/site-packages/pyspark/sql/column.py", line 51, in _create_column_from_literal
    return cast(JVMView, sc._jvm).functions.lit(literal)
  File "/home/airflow/.local/lib/python3.8/site-packages/py4j/java_gateway.py", line 1322, in __call__
    return_value = get_return_value(
  File "/home/airflow/.local/lib/python3.8/site-packages/pyspark/errors/exceptions/captured.py", line 185, in deco
    raise converted from None
pyspark.errors.exceptions.captured.SparkRuntimeException: [UNSUPPORTED_FEATURE.LITERAL_TYPE] The feature is not supported: Literal for '{earnings_from_cont_ops_value={2=94,680.0}, eps_yoy_value={2=71.34%}, interest_on_long_term_debt_raw_value={2=2600000000.0}, operating_income_raw_value={2=108949000000.0}, earnings_from_cont_ops_raw_value={2=94680000000.0}, weighted_average_basic_shares_outstanding_value={2=16,701.3}, RowKey={2=Sep 2021}, ebitda_value={2=120,233.0}, operating_income_value={2=108,949.0}, net_income_revenue_percent={2=25.88%}, payout_ratio_yoy_value={2=(37.70%)}, interest_expense_total_raw_value={2=-2645000000.0}, eps_value={2=$5.67}, interest_expense_total_yoy_value={2=-7.94%}, ebitdar_yoy_value={2=52.97%}, div_rate_raw_value={2=0.85}, ebitda_raw_value={2=120233000000.0}, other_operating_exp_total_revenue_percent={2=12.00%}, ebit_op_in_raw_value={2=108949000000.0}, selling_general_admin_expenses_total_revenue_percent={2=6.01%}, normalized_diluted_eps_raw_value={2=4.047121}, PartitionKey={2=aapl}, rd_expenses_revenue_percent={2=5.99%}, interest_expense_total_value={2=(2,645.0)}, r_d_exp_raw_value={2=21914000000.0}, other_revenues_summary_subtotal_value={2=-}, selling_general_admin_expenses_total_value={2=21,973.0}, other_non_operating_income_yoy_value={2=-}, cost_revenue_raw_value={2=212981000000.0}, diluted_eps_raw_value={2=5.61}, eps_raw_value={2=5.669029}, interest_expense_total_revenue_percent={2=(0.72%)}, ni_to_common_excl_extra_items_raw_value={2=94680000000.0}, weighted_average_diluted_shares_outstanding_yoy_value={2=(3.78%)}, effective_tax_rate_yoy_value={2=(7.80%)}, foreign_sales_raw_value={2=232014000000.0}, revenues_yoy_value={2=33.26%}, other_operating_exp_total_value={2=43,887.0}, basic_eps_excl_extra_items_value={2=$5.67}, rd_expenses_raw_value={2=21914000000.0}, ni_to_common_incl_extra_items_raw_value={2=94680000000.0}, payout_ratio_raw_value={2=15.2798}, gross_profit_value={2=152,836.0}, ebita_yoy_value={2=64.36%}, ebitda_yoy_value={2=55.45%}, cost_revenue_revenue_percent={2=58.22%}, other_non_operating_income_revenue_percent={2=0.02%}, normalized_basic_eps_raw_value={2=4.086777}, ebitdar_raw_value={2=134833000000.0}, normalized_net_income_raw_value={2=68254375000.0}, ni_to_common_excl_extra_items_value={2=94,680.0}, selling_general_admin_expenses_total_yoy_value={2=10.33%}, ebit_op_in_yoy_value={2=64.36%}, div_rate_yoy_value={2=6.92%}, diluted_eps_excl_extra_itmes_raw_value={2=5.61}, cost_revenue_yoy_value={2=25.61%}, operating_income_revenue_percent={2=29.78%}, revenues_value={2=365,817.0}, ni_to_common_incl_extra_items_revenue_percent={2=25.88%}, net_interest_exp_standard_raw_value={2=198000000.0}, weighted_average_basic_shares_outstanding_raw_value={2=16701272000.0}, total_revenue_raw_value={2=365817000000.0}, diluted_eps_value={2=$5.61}, ebita_raw_value={2=108949000000.0}, other_non_operating_income_raw_value={2=60000000.0}, foreign_sales_yoy_value={2=40.34%}, effective_tax_rate_value={2=13.3%}, total_revenue_value={2=365,817.0}, weighted_average_diluted_shares_outstanding_raw_value={2=16864919000.0}, cost_revenue_value={2=212,981.0}, ni_to_common_excl_extra_items_yoy_value={2=64.92%}, effective_tax_rate_raw_value={2=13.3022}, gross_profit_raw_value={2=152836000000.0}, interest_on_long_term_debt_value={2=2,600.0}, r_d_exp_value={2=21,914.0}, normalized_diluted_eps_yoy_value={2=69.18%}, basic_eps_excl_extra_items_yoy_value={2=71.34%}, revenues_raw_value={2=365817000000.0}, interest_and_investment_income_yoy_value={2=(24.45%)}, normalized_net_income_value={2=68,254.4}, ebt_incl_unusual_items_yoy_value={2=62.77%}, revenue_per_share_raw_value={2=21.903541}, ebitdar_value={2=134,833.0}, income_tax_expense_yoy_value={2=50.07%}, earnings_from_cont_ops_revenue_percent={2=25.88%}, ni_to_common_incl_extra_items_yoy_value={2=64.92%}, normalized_basic_eps_value={2=$4.09}, normalized_net_income_yoy_value={2=62.77%}, normalized_basic_eps_yoy_value={2=69.12%}, net_interest_exp_standard_yoy_value={2=(77.75%)}, revenue_per_share_value={2=$21.90}, net_income_raw_value={2=94680000000.0}, div_rate_value={2=$0.85}, net_interest_exp_standard_value={2=198.0}, ebit_op_in_value={2=108,949.0}, rd_expenses_yoy_value={2=16.86%}, basic_eps_excl_extra_items_raw_value={2=5.669029}, net_income_to_company_yoy_value={2=64.92%}, net_income_value={2=94,680.0}, other_revenues_summary_subtotal_revenue_percent={2=}, weighted_average_basic_shares_outstanding_yoy_value={2=(3.75%)}, payout_ratio_value={2=15.28%}, rd_expenses_value={2=21,914.0}, other_operating_exp_total_yoy_value={2=13.50%}, net_interest_exp_standard_revenue_percent={2=0.05%}, total_revenue_revenue_percent={2=100%}, selling_general_admin_expenses_total_raw_value={2=21973000000.0}, diluted_eps_excl_extra_itmes_yoy_value={2=71.04%}, operating_income_yoy_value={2=64.36%}, ebt_incl_unusual_items_revenue_percent={2=29.85%}, interest_on_long_term_debt_yoy_value={2=(7.14%)}, interest_and_investment_income_value={2=2,843.0}, ni_to_common_incl_extra_items_value={2=94,680.0}, total_revenue_yoy_value={2=33.26%}, net_income_to_company_value={2=94,680.0}, weighted_average_diluted_shares_outstanding_value={2=16,864.9}, net_income_to_company_revenue_percent={2=25.88%}, ebt_incl_unusual_items_raw_value={2=109207000000.0}, earnings_from_cont_ops_yoy_value={2=64.92%}, interest_and_investment_income_raw_value={2=2843000000.0}, income_tax_expense_revenue_percent={2=3.97%}, income_tax_expense_raw_value={2=14527000000.0}, foreign_sales_value={2=232,014.0}, gross_profit_yoy_value={2=45.62%}, revenue_per_share_yoy_value={2=38.45%}, ebt_incl_unusual_items_value={2=109,207.0}, interest_and_investment_income_revenue_percent={2=0.78%}, normalized_diluted_eps_value={2=$4.05}, other_operating_exp_total_raw_value={2=43887000000.0}, ni_to_common_excl_extra_items_revenue_percent={2=25.88%}, net_income_yoy_value={2=64.92%}, r_d_exp_yoy_value={2=16.86%}, income_tax_expense_value={2=14,527.0}, other_non_operating_income_value={2=60.0}, diluted_eps_yoy_value={2=71.04%}, diluted_eps_excl_extra_itmes_value={2=$5.61}, gross_profit_revenue_percent={2=41.78%}, ebita_value={2=108,949.0}, net_income_to_company_raw_value={2=94680000000.0}, revenues_revenue_percent={2=100.00%}}' of class java.util.HashMap.
[2024-02-01T10:35:43.881+0000] {taskinstance.py:1400} INFO - Marking task as UP_FOR_RETRY. dag_id=calculating_gross_margin, task_id=calculating_gross_margin, execution_date=20240201T100920, start_date=20240201T103534, end_date=20240201T103543
[2024-02-01T10:35:43.898+0000] {standard_task_runner.py:104} ERROR - Failed to execute job 122 for task calculating_gross_margin ([UNSUPPORTED_FEATURE.LITERAL_TYPE] The feature is not supported: Literal for '{earnings_from_cont_ops_value={2=94,680.0}, eps_yoy_value={2=71.34%}, interest_on_long_term_debt_raw_value={2=2600000000.0}, operating_income_raw_value={2=108949000000.0}, earnings_from_cont_ops_raw_value={2=94680000000.0}, weighted_average_basic_shares_outstanding_value={2=16,701.3}, RowKey={2=Sep 2021}, ebitda_value={2=120,233.0}, operating_income_value={2=108,949.0}, net_income_revenue_percent={2=25.88%}, payout_ratio_yoy_value={2=(37.70%)}, interest_expense_total_raw_value={2=-2645000000.0}, eps_value={2=$5.67}, interest_expense_total_yoy_value={2=-7.94%}, ebitdar_yoy_value={2=52.97%}, div_rate_raw_value={2=0.85}, ebitda_raw_value={2=120233000000.0}, other_operating_exp_total_revenue_percent={2=12.00%}, ebit_op_in_raw_value={2=108949000000.0}, selling_general_admin_expenses_total_revenue_percent={2=6.01%}, normalized_diluted_eps_raw_value={2=4.047121}, PartitionKey={2=aapl}, rd_expenses_revenue_percent={2=5.99%}, interest_expense_total_value={2=(2,645.0)}, r_d_exp_raw_value={2=21914000000.0}, other_revenues_summary_subtotal_value={2=-}, selling_general_admin_expenses_total_value={2=21,973.0}, other_non_operating_income_yoy_value={2=-}, cost_revenue_raw_value={2=212981000000.0}, diluted_eps_raw_value={2=5.61}, eps_raw_value={2=5.669029}, interest_expense_total_revenue_percent={2=(0.72%)}, ni_to_common_excl_extra_items_raw_value={2=94680000000.0}, weighted_average_diluted_shares_outstanding_yoy_value={2=(3.78%)}, effective_tax_rate_yoy_value={2=(7.80%)}, foreign_sales_raw_value={2=232014000000.0}, revenues_yoy_value={2=33.26%}, other_operating_exp_total_value={2=43,887.0}, basic_eps_excl_extra_items_value={2=$5.67}, rd_expenses_raw_value={2=21914000000.0}, ni_to_common_incl_extra_items_raw_value={2=94680000000.0}, payout_ratio_raw_value={2=15.2798}, gross_profit_value={2=152,836.0}, ebita_yoy_value={2=64.36%}, ebitda_yoy_value={2=55.45%}, cost_revenue_revenue_percent={2=58.22%}, other_non_operating_income_revenue_percent={2=0.02%}, normalized_basic_eps_raw_value={2=4.086777}, ebitdar_raw_value={2=134833000000.0}, normalized_net_income_raw_value={2=68254375000.0}, ni_to_common_excl_extra_items_value={2=94,680.0}, selling_general_admin_expenses_total_yoy_value={2=10.33%}, ebit_op_in_yoy_value={2=64.36%}, div_rate_yoy_value={2=6.92%}, diluted_eps_excl_extra_itmes_raw_value={2=5.61}, cost_revenue_yoy_value={2=25.61%}, operating_income_revenue_percent={2=29.78%}, revenues_value={2=365,817.0}, ni_to_common_incl_extra_items_revenue_percent={2=25.88%}, net_interest_exp_standard_raw_value={2=198000000.0}, weighted_average_basic_shares_outstanding_raw_value={2=16701272000.0}, total_revenue_raw_value={2=365817000000.0}, diluted_eps_value={2=$5.61}, ebita_raw_value={2=108949000000.0}, other_non_operating_income_raw_value={2=60000000.0}, foreign_sales_yoy_value={2=40.34%}, effective_tax_rate_value={2=13.3%}, total_revenue_value={2=365,817.0}, weighted_average_diluted_shares_outstanding_raw_value={2=16864919000.0}, cost_revenue_value={2=212,981.0}, ni_to_common_excl_extra_items_yoy_value={2=64.92%}, effective_tax_rate_raw_value={2=13.3022}, gross_profit_raw_value={2=152836000000.0}, interest_on_long_term_debt_value={2=2,600.0}, r_d_exp_value={2=21,914.0}, normalized_diluted_eps_yoy_value={2=69.18%}, basic_eps_excl_extra_items_yoy_value={2=71.34%}, revenues_raw_value={2=365817000000.0}, interest_and_investment_income_yoy_value={2=(24.45%)}, normalized_net_income_value={2=68,254.4}, ebt_incl_unusual_items_yoy_value={2=62.77%}, revenue_per_share_raw_value={2=21.903541}, ebitdar_value={2=134,833.0}, income_tax_expense_yoy_value={2=50.07%}, earnings_from_cont_ops_revenue_percent={2=25.88%}, ni_to_common_incl_extra_items_yoy_value={2=64.92%}, normalized_basic_eps_value={2=$4.09}, normalized_net_income_yoy_value={2=62.77%}, normalized_basic_eps_yoy_value={2=69.12%}, net_interest_exp_standard_yoy_value={2=(77.75%)}, revenue_per_share_value={2=$21.90}, net_income_raw_value={2=94680000000.0}, div_rate_value={2=$0.85}, net_interest_exp_standard_value={2=198.0}, ebit_op_in_value={2=108,949.0}, rd_expenses_yoy_value={2=16.86%}, basic_eps_excl_extra_items_raw_value={2=5.669029}, net_income_to_company_yoy_value={2=64.92%}, net_income_value={2=94,680.0}, other_revenues_summary_subtotal_revenue_percent={2=}, weighted_average_basic_shares_outstanding_yoy_value={2=(3.75%)}, payout_ratio_value={2=15.28%}, rd_expenses_value={2=21,914.0}, other_operating_exp_total_yoy_value={2=13.50%}, net_interest_exp_standard_revenue_percent={2=0.05%}, total_revenue_revenue_percent={2=100%}, selling_general_admin_expenses_total_raw_value={2=21973000000.0}, diluted_eps_excl_extra_itmes_yoy_value={2=71.04%}, operating_income_yoy_value={2=64.36%}, ebt_incl_unusual_items_revenue_percent={2=29.85%}, interest_on_long_term_debt_yoy_value={2=(7.14%)}, interest_and_investment_income_value={2=2,843.0}, ni_to_common_incl_extra_items_value={2=94,680.0}, total_revenue_yoy_value={2=33.26%}, net_income_to_company_value={2=94,680.0}, weighted_average_diluted_shares_outstanding_value={2=16,864.9}, net_income_to_company_revenue_percent={2=25.88%}, ebt_incl_unusual_items_raw_value={2=109207000000.0}, earnings_from_cont_ops_yoy_value={2=64.92%}, interest_and_investment_income_raw_value={2=2843000000.0}, income_tax_expense_revenue_percent={2=3.97%}, income_tax_expense_raw_value={2=14527000000.0}, foreign_sales_value={2=232,014.0}, gross_profit_yoy_value={2=45.62%}, revenue_per_share_yoy_value={2=38.45%}, ebt_incl_unusual_items_value={2=109,207.0}, interest_and_investment_income_revenue_percent={2=0.78%}, normalized_diluted_eps_value={2=$4.05}, other_operating_exp_total_raw_value={2=43887000000.0}, ni_to_common_excl_extra_items_revenue_percent={2=25.88%}, net_income_yoy_value={2=64.92%}, r_d_exp_yoy_value={2=16.86%}, income_tax_expense_value={2=14,527.0}, other_non_operating_income_value={2=60.0}, diluted_eps_yoy_value={2=71.04%}, diluted_eps_excl_extra_itmes_value={2=$5.61}, gross_profit_revenue_percent={2=41.78%}, ebita_value={2=108,949.0}, net_income_to_company_raw_value={2=94680000000.0}, revenues_revenue_percent={2=100.00%}}' of class java.util.HashMap.; 62)
[2024-02-01T10:35:43.918+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 1
[2024-02-01T10:35:43.946+0000] {taskinstance.py:2778} INFO - 0 downstream tasks scheduled from follow-on schedule check
